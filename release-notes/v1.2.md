## 1.2 版本发布

### 亮点

- **增强的研究工作流架构** - 完善多阶段 AI 编排系统（Qwen-flash、Qwen-plus、Qwen3-max），新增阶段 0.5 自动角色生成功能，根据内容特征智能生成最适合的研究角色，提升研究针对性和专业性。

- **全新导出功能** - 新增研究报告导出 API 端点，支持多种格式导出研究成果，便于分享和存档。用户可通过 `/api/exports` 接口轻松导出完整研究报告和会话数据。

- **智能内容标记系统** - 引入基于标记（Markers）的内容分析机制，自动识别关键事实（Facts）、关键观点（Opinions）、关键数据点（Data），大幅提升后续阶段处理效率和研究质量。

- **优化的会话管理** - 完善研究会话持久化和恢复机制，支持断点续传，确保长时间研究任务的连续性。新增会话步骤详细追踪功能（`/api/sessions/{session_id}/steps`），实时监控研究进展。

- **增强的向量检索能力** - 集成向量存储（Vector Store）和嵌入（Embeddings）模块，支持语义搜索和上下文相关内容检索。Phase 3 研究阶段可智能检索相关内容片段，提供更精准的研究支持。

- **改进的 UI/UX 体验** - 前端新增 Phase 3 专属会话页面（`Phase3SessionPage.tsx`），提供多轮对话式研究界面。优化历史记录页面，支持批次查看和删除操作，提升用户工作流体验。

- **全面的日志和监控** - 集成 Loguru 统一日志系统，提供结构化日志输出。后端启动时自动检测模块加载状态，便于快速定位配置问题。日志文件保存至 `logs/` 目录，支持日志轮转和查询。

- **灵活的配置管理** - 完善 CORS 配置支持，允许自定义跨域资源访问规则。新增配置验证机制，启动时自动检查必需配置项，防止运行时错误。

### 新增功能

#### 研究功能增强
- **阶段 0.5 角色生成** - 基于内容摘要和标记信息，自动生成专业研究角色，如"游戏设计分析师"、"技术评论员"等，使后续研究更加专业化和聚焦。
- **标记驱动的目标发现** - Phase 1 阶段基于标记概览（Marker Overview）识别研究目标，不受数量限制，自动生成尽可能多的高价值研究问题。
- **智能数据使用策略** - 研究步骤自动判断所需数据类型（transcript、transcript_with_comments 等）和分块策略（sequential、all），优化大规模数据处理性能。
- **Phase 4 提示词重构** - 全面更新大纲与成品写作提示，新增 coverage matrix、supporting_steps/ supporting_evidence 等结构约束，并统一附录规范，确保最终报告与 Phase 3 洞察严格对齐。

#### API 端点扩展
- **导出接口** - `POST /api/exports` - 导出研究报告和会话数据
- **会话步骤查询** - `GET /api/sessions/{session_id}/steps` - 获取详细研究步骤信息
- **批次历史管理** - `GET /api/history/{batch_id}` - 查询特定批次历史记录
- **批次删除** - `DELETE /api/history/{batch_id}` - 清理过期或无用的研究批次

#### 前端组件更新
- **Phase3SessionPage** - 专为 Phase 3 详细研究阶段设计的交互界面，支持多轮对话和实时反馈
- **改进的历史页面** - 增强历史记录管理功能，支持批次筛选、删除和快速恢复会话
- **增强的进度显示** - WebSocket 实时推送更详细的进度信息，包括当前阶段、子步骤和百分比

#### 技术基础设施
- **向量存储集成** - 使用 SQLite 向量数据库存储内容嵌入，支持高效语义检索
- **嵌入生成器** - 支持多种嵌入模型，可配置嵌入维度和批处理大小
- **检索处理器** - 智能内容检索机制，支持窗口滑动、相关性排序和去重
- **进度追踪器** - 完善的进度追踪系统，支持会话恢复、进度转换和状态持久化

### 修复与改进

#### 稳定性提升
- **智能工作流恢复** - 修复历史会话恢复时重复抓取问题。后端会检查 phase0 是否已完成，如果抓取已完成则直接跳过抓取进入研究阶段。前端也已修复，现在会正确判断工作流状态并触发恢复，不再依赖可能不准确的 `resume_required` 标志。前端现在正确处理 `scraping:already_complete` 消息，自动导航到研究页面而不是停留在抓取进度页面
- **研究角色占位符修复** - 全面修复所有研究阶段中缺失 `system_role_description` 占位符的问题：
  - Phase 0.5 (角色生成): 使用默认的"智能研究助理"角色
  - Phase 1 (目标发现): 通过 `format_research_role_for_context` 获取生成的角色
  - Phase 1.5, Phase 2 (目标综合/计划): 从会话元数据中获取角色
  - Phase 4 (报告生成): 从上下文包中提取角色
  - 所有阶段现在都能正确使用生成的研究角色或回退到默认角色
- **前后端状态同步** - 修复前端 UI 与后端工作流状态不同步的问题。现在当后端跳过抓取直接进入研究阶段时，前端会正确标记抓取为完成并自动导航到研究页面，避免 UI 卡在 0% 完成度的抓取页面
- **健壮的错误处理** - 在所有模块导入和初始化环节增加详细错误捕获和日志记录，启动失败时提供清晰的诊断信息
- **会话恢复机制** - 修复长时间研究中断后的恢复问题，确保会话状态完整性和数据一致性
- **WebSocket 连接管理** - 优化 WebSocket 连接池管理，防止连接泄漏和意外断开

#### 性能优化
- **并行内容处理** - 改进多 URL 并行抓取性能，优化工作线程分配策略
- **缓存机制增强** - 完善 URL 缓存逻辑，避免重复抓取相同内容，显著降低 API 调用成本
- **大数据集处理** - 针对超过 50,000 词的大型数据集，自动启用顺序分块策略，防止内存溢出

#### 文档完善
- **API 文档更新** - 更新 Swagger UI 和 ReDoc，新增所有 v1.2 端点的详细说明和示例
- **配置指南增强** - 补充向量存储、嵌入配置、日志配置等新增配置项的说明和最佳实践
- **故障排查指南** - 新增向量存储、会话恢复、WebSocket 连接等常见问题的排查步骤

#### 代码质量
- **统一日志规范** - 全面采用 Loguru 替代分散的 print 语句，提供结构化、可追溯的日志输出
- **模块化改进** - 重构嵌入、检索、向量存储等功能为独立模块，提升代码可维护性和可测试性
- **类型注解增强** - 补充关键函数和类的类型提示，提升代码可读性和 IDE 支持

### 依赖更新

#### 后端新增依赖
- **loguru** - 高级 Python 日志库，提供美观且强大的日志功能
- **chromadb** 或 **faiss** (可选) - 向量数据库支持（当前使用 SQLite）
- **sentence-transformers** (可选) - 本地嵌入生成

#### 前端依赖优化
- 升级 React Router 至最新稳定版
- 更新 Zustand 状态管理库
- 优化 TypeScript 配置，启用严格模式

### 迁移指南

#### 从 v1.1 升级到 v1.2

1. **更新依赖**
   ```bash
   pip install -r requirements.txt --upgrade
   cd client && npm install
   ```

2. **更新配置文件**
   - 复制 `config.yaml.example` 中的新配置项到您的 `config.yaml`
   - 重点配置 `vector_store`、`embeddings`、`logging` 部分

3. **初始化向量存储**
   ```bash
   # 首次启动会自动创建向量数据库
   python backend/run_server.py
   ```

4. **清理旧会话（可选）**
   - 如遇到会话格式兼容问题，可删除 `data/research/sessions/` 中的旧会话文件
   - 历史报告不受影响，保留在 `data/research/reports/` 中

5. **测试升级**
   ```bash
   # 测试后端健康状态
   python test_backend_health.py
   
   # 测试 WebSocket 连接
   python scripts/test_websocket_quick.py
   ```

### 已知问题

- **向量存储初始化** - 首次使用向量检索时可能需要较长时间生成嵌入，请耐心等待
- **大规模数据集** - 处理超过 100,000 词的数据集时，建议增加系统内存或调整 `window_words` 配置
- **浏览器自动化** - 在某些环境下 Playwright 可能无法启动，请确保已运行 `playwright install chromium`

### 致谢

感谢所有贡献者对 v1.2 版本的贡献，特别是在向量检索、日志系统和前端优化方面的改进。

---

**发布日期:** 2025-11-11  
**版本号:** v1.2.0  
**最低 Python 版本:** 3.9+  
**最低 Node.js 版本:** 18+




